---
output: rmarkdown::html_document
editor_options: 
  markdown: 
    wrap: 72
---

<!-- README.md is automatically generated from README.Rmd. Please only edit this Rmd file! -->

<!-- knitr before every resubmission -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  collapse = TRUE,
  comment = "#>",
  fig.width = 8,
  fig.height = 5,
  out.width = "100%",
  fig.path = "man/figures/README-"
)
```

# visStatistics

Visualization of the statistical hypothesis test with the highest
statistical power between two groups of categorical or numerical data.

# Abstract {.unnumbered}

The `visStatistics` package provides rapid visualization and statistical analysis of raw data by automatically selecting the hypothesis test with the highest statistical power. It evaluates the relationship between a dependent variable (`varsample`) and an independent variable (`varfactor`) within a `data.frame`.

A minimal function call is structured as follows:

The R package `visStatistics` provides an automated approach to visualising and testing statistical relationships between two variables in raw data. Given a response variable (`varsample`) and a feature variable (`varfactor`) from a `data.frame`, the function `visstat()` selects the most appropriate hypothesis test based on variable types, group sizes, and distributional assumptions.

The function generates a clear visual summary of the selected test???such as box plots, regression lines, or mosaic plots???along with annotated $p$-values and relevant post hoc results when applicable. Test selection  by automatically selecting the hypothesis test with the highest statistical power., including the use of Welch???s t-test, Wilcoxon rank-sum test, ANOVA, Kruskal-Wallis, chi-squared, Fisher???s exact test, or simple linear regression, depending on the input.

A minimal call to the core function looks like:




```r
visstat(dataframe, varsample, varfactor)
```

The input `dataframe` must contain the variables in columns. The arguments `varsample` and `varfactor` are character strings that specify the names of the dependent (response) and independent (feature) variables, respectively.


The statistical test selected by `visstat()` depends on:

- variable types (numeric or categorical),
- number of levels in `varfactor`,
- sample size
- distributional assumptions.

For example:

- A *t*-test is used to compare group means when the response is numeric, the factor has two levels, and normality can be assumed,  
- A Wilcoxon rank-sum test is used instead when the response is numeric, the factor has two levels, and normality cannot be assumed,  
- A ANOVA is used when the response is numeric, the factor has more than two levels, and both normality and homogeneity of variance are assumed,  
- The Kruskal-Wallis test is used when the response is numeric, the factor has more than two levels, but normality or homoscedacity cannot be assumed,  
- Linear regression is applied when both response and predictor are numeric,  
- The ${\chi}^2$ test or Fisher's exact test is used for associations between categorical variables, depending on cell counts.


The `visstat()` function selects the appropriate statistical test based on the type of response and feature variables, the number of groups, sample size, and distributional assumptions. The logic is as follows:

- Comparing means between two groups (numeric response, two-level factor):
  - If both groups have sample sizes > 30, a parametric *t*-test is applied (Lumley et al., 2002 <doi:10.1146/annurev.publhealth.23.100901.140546>).
  - Otherwise, normality of residuals from a linear model is assessed using both `shapiro.test()`
    - If the `shapiro.test()` tests return p-values smaller than the significance level (i.e., the null of normality is rejected), the Wilcoxon rank-sum test (`wilcox.test()`) is used.
    - If normality is not rejected, the **t-test** (`t.test()`) is used.

- Comparing means across more than two groups (numeric response, factor with >2 levels):
  - Normality is assessed using both `shapiro.test()` and `ad.test()` on the standardized residuals of the regression model:
    - If both tests reject normality (p-values < 1 - `conf.level`), the **Kruskal???Wallis test** (`kruskal.test()`) is applied.
   - Homoscedacity is tested via the **ANOVA** (`aov()` or `oneway.test()`) is used.

- **Association between two categorical variables:**
  - If all expected cell counts are ??? 5, the **Chi-squared test** is used (`chisq.test()`).
  - Otherwise, the **Fisher???s exact test** (`fisher.test()`) is applied.

- **Relationship between two numeric variables:**
  - A **linear regression** model is fitted and tested using `lm()` and `summary.lm()`.

This decision framework ensures the statistical test with the highest power is chosen, while respecting the underlying assumptions of each test.




The function generates a plot summarizing the selected test and returns detailed test statistics as part of its output.

This automated workflow is especially useful for browser-based interfaces or server-side R applications connected to databases.

A full description of the package and its decision logic is provided in the accompanying vignette. A graphical representation of the decision tree for a numeric response and categorical feature is shown below.

```{r fig-decision-tree, fig.cap="Decision tree used to select the appropriate statistical test for a categorical predictor and numerical response, based on the number of factor levels, normality and homoscedasticity.", out.width="100%,fig.height ="}
knitr::include_graphics("vignettes/figures/decision_tree_v6.pdf")
```
## Implemented tests

`lm()`, `t.test()`, `wilcox.test()`, `aov()`, `kruskal.test()`,
`fisher.test()`, `chisqu.test()`

### Implemented tests to check the normal distribution of standardized residuals

`shapiro.test()` and `ad.test()`

### Implemented post-hoc tests

`TukeyHSD()` for `aov()`and `pairwise.wilcox.test()` for
`kruskal.test()`

## Installation latest stable version from CRAN

1.  Install the package `install.packages("visStatistics")`
2.  Load the package `library(visStatistics)`

## Installation of developing version from GitHub

1.  Install the devtools package from CRAN. Invoke R and type
    `install.packages("devtools")`
2.  Load the devtools package. `library(devtools)`
3.  Install the package from the github-repository
    `install_github("shhschilling/visStatistics")`
4.  Load the package `library(visStatistics)`
5.  Help on the function usage `?visstat`

## Getting Started

The package vignette allows you to get familiar with all features of
`visStatistics`. It documents in detail the decision logic  illustrated by below examples.

## Examples

```{r example}
library(visStatistics)
```

### Welch's t-test

#### InsectSprays data set

```{r}
insect_sprays_a_b <- 
  InsectSprays[which(InsectSprays$spray == "A" | InsectSprays$spray == "B"), ]
insect_sprays_a_b$spray <- factor(insect_sprays_a_b$spray)
visstat(insect_sprays_a_b, "count", "spray")
```

#### mtcars data set

```{r}
```

```{r}
mtcars$am <- as.factor(mtcars$am)
t_test_statistics <- visstat(mtcars, "mpg", "am")
```

### Wilcoxon rank sum test

```{r}
grades_gender <- data.frame(
  sex = as.factor(c(rep("girl", 21), rep("boy", 23))),
  grade = c(
    19.3, 18.1, 15.2, 18.3, 7.9, 6.2, 19.4,
    20.3, 9.3, 11.3, 18.2, 17.5, 10.2, 20.1, 13.3, 17.2, 15.1, 16.2, 17.0,
    16.5, 5.1, 15.3, 17.1, 14.8, 15.4, 14.4, 7.5, 15.5, 6.0, 17.4,7.3, 14.3, 
    13.5, 8.0, 19.5, 13.4, 17.9, 17.7, 16.4, 15.6, 17.3, 19.9, 4.4, 2.1
  )
)

wilcoxon_statistics <- visstat(grades_gender, "grade", "sex")
```

### ANOVA

```{r}
insect_sprays_tr <- InsectSprays
insect_sprays_tr$count_sqrt <- sqrt(InsectSprays$count)
visstat(insect_sprays_tr, "count_sqrt", "spray")
```

### One-way test

```{r}
one_way_npk <- visstat(npk, "yield", "block")
```

### Kruskal-Wallis test

The generated graphs can be saved in all available formats of the
`Cairo` package. Here we save the graphical output of type "pdf" in the
`plotDirectory` `tempdir()`:

```{r}
visstat(iris, "Petal.Width", "Species", 
        graphicsoutput = "pdf", plotDirectory = tempdir())
```

### Linear Regression

```{r}
linreg_cars <- visstat(cars, "dist", "speed")
```

Increasing the confidence level `conf.level` from the default 0.95 to
0.99 leads two wider confidence and prediction bands:

```{r pressure, echo = FALSE}
linreg_cars_99 <- visstat(cars, "dist", "speed", conf.level = 0.99)
```

### Pearson's Chi-squared test

Count data sets are often presented as multidimensional arrays,
so-called contingency tables, whereas `visstat()` requires a
`data.frame` with a column structure. Arrays can be transformed to this
column wise structure with the helper function `counts_to_cases()`:

```{r}
hair_eye_color_df <- counts_to_cases(as.data.frame(HairEyeColor))
visstat(hair_eye_color_df, "Hair", "Eye")
```

### Fisher's exact test

```{r}
hair_eye_color_male <- HairEyeColor[, , 1]
# Slice out a 2 by 2 contingency table
black_brown_hazel_green_male <- hair_eye_color_male[1:2, 3:4]
#Transform to data frame
black_brown_hazel_green_male <- counts_to_cases(as.data.frame(black_brown_hazel_green_male))
# Fisher test
fisher_stats <- visstat(black_brown_hazel_green_male, "Hair", "Eye")
```
