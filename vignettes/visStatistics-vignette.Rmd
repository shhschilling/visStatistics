---
title: "visStatistics"
author: "Sabine Schilling"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    number_sections: true
    toc: true
bibliography: visstat.bib
vignette: >
  %\VignetteIndexEntry{visStatistics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
<style type="text/css">
  body{
  font-size: 12pt;
}
</style>




```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width=7,
  fig.height=7
)
```

```{r setup}
library(visStatistics)
```

<!-- Unnumbered section -->
# Abstract{-}
Statistical consulting  requires often both a quick first visualization and a reproducible statistical analysis of the presented raw data. The package `visStatistics` with its core function `visstat()` fulfils this need. Based on a decision tree it picks the 
statistical hypothesis test  with the highest statistical power between the dependent variable (response) `varsample` and the independent variable (feature) `varfactor`. The corresponding test statistics including eventual post-hoc-analysis are returned and 
a graph showing key statistics of the underlying test is generated. This fully automated workflow is especially suited for browser based interfaces to server-based deployments of R and has been successfully implemented to analyse medical raw data in an unbiased fashion. 
This vignette  documents the algorithm underlying the decision tree of `vistat()`. 
The decision tree  depends on the type of the  data (numerical/integer or categorical),
the number of levels of categorical data and the data distributions. 
For the comparison of averages, the implemented algorithm  depends on the value of the chosen confidence level of the parameter `conf.level`,defaulting to 0.95. 



# Two sample tests: Welch's t-Test or Wilcoxon rank sum test

If the feature `varfactor` has two levels and  the response `varsample` is of type numerical or integer, either a Welch's t-Test `t.test()` or `wilcox.test()`  with their respective default parameter settings are executed. 
Al underlying statistical functions are called  with their default parameters. 
Only the parameter `conf.level`, defaulting to 0.95, can be adapted by the user. 
The choice of either test follows the following algorithm: 

* If the sample size of both samples is bigger than 100, the function `visstat()` performs always **Welch's t-Test** (`t.test()`) [@Lumley:2002dsa ]. 

    **Graphical representation**
    
    The title names the used test, the underlying null hypothesis with the associated p-value of the null hypothesis. 
    A box plot with an overlayed jitter plot showing each data point is generated. The number of data entry of each sample is displayed above each box. The means and confidence intervals are displayed in red. The confidence intervals are corrected for the familywise error rate in pairwise comparison by the Sidak method [@Sidak]. 
    The applied corrected probability of error is $\alpha_{Sidak}=1-$`conf.int`$^{1/2}$.

    **Statistical output**
    
    The test statistics of the Shapiro-Wilk test on the standardized residuals as well of      Welch's t-test are returned. 

* If the sample size of one of the samples is smaller  than 100, `viststat()` checks  for the normality of the standardized residuals of both samples with the Shapiro-Wilk Normality Test (`shapiro.test()`). If the normality assumption is met, Welch's t-Test is performed, otherwise the Wilcoxon rank sum test. The detailed algorithm is: 

  * If the p-values of the standardized residuals of both distributions in the `shapiro.test()` are bigger
  than the error probability `1-conf.level`,    **Welch's t-Test** (`t.test()`) is executed. Otherwise, 
  
  * if the p-values of the standardized residuals of both distributions in the `shapiro.test()` are smaller 
  than the error probability `1-conf.level`,  a  **Wilcoxon rank sum test** (`wilcox.test()`) is executed.
    
    **Graphical representation**
    
    Analogue to Welch's t-test omiting mean and confidence interval. 
    
     **Statistical output**
     
    The test statistics  of the Wilcoxon rank sum test as well as the summary statistics of the generated
    boxplots is generated.
    
    
    

##     Examples
```{r}
# Welch's  t-test calling t.test()
mtcars$am=as.factor(mtcars$am)
ttestStatistics=visstat(mtcars,"mpg","am") 
# print out test statistics 
ttestStatistics
```
```{r}
# Wilcoxon rank sum test (calling wilcox.test())
grades_gender <- data.frame(
Sex = as.factor(c(rep("Girl", 20), rep("Boy", 20))),
Grade = c(19.3, 18.1, 15.2, 18.3, 7.9, 6.2, 19.4, 
            20.3, 9.3, 11.3, 18.2,17.5,10.2,20.1,13.3,17.2,15.1,16.2,17.3,
            16.5, 5.1, 15.3, 17.1, 14.8, 15.4, 14.4, 7.5, 15.5, 6.0,17.4,
            7.3, 14.3,13.5,8.0,19.5,13.4,17.9,17.7,16.4,15.6))

welchtestStatistics=visstat(grades_gender,"Grade", "Sex")
```

# More than two samples: One Way Test, ANOVA and Kruskal-Wallis-Test

If the feature `varfactor` has more than two levels and  the response `varsample` is of type numerical or integer, 
either a Welch's t-Test `t.test()` or `wilcox.test()`  with their respective default parameter settings are executed. 

# Implemented tests
`lm()`, `t.test()`, `wilcox.test()`, `aov()`, `kruskal.test()`, `fisher.test()`, `chisqu.test()`

## Implemented tests to check the normal distribution of standardized residuals
`shapiro.test()` and `ad.test()`

##Implemented post-hoc tests
`TukeyHSD()` for `aov() `and `pairwise.wilcox.test()` for `kruskal.test()`.
    For the comparison of averages, the implemented algorithm  depends on the value of the parameter of conf.level, which defaults to 0.95: 
    If the p-values of the standardized residuals of both shapiro.test() or ad.test() are smaller 
    than the error probability 1-conf.level, kruskal.test() resp. wilcox.test() are performed, otherwise the oneway.test()
    and aov() resp. t.test() are performed and displayed. Exception: 
    If the sample size is bigger than 100, t.test() is always performed and wilcox.test() is never executed 
    (Lumley et al. (2002) <doi:10.1146/annurev.publhealth.23.100901.140546>). 
    For the test of independence of count data, Cochran's rule (Cochran (1954) <doi:10.2307/3001666>) is implemented: 
    If more than 20 percent of all cells have a count smaller than 5, fisher.test() is performed and displayed,
    otherwise chisqu.test(). In both cases case an additional mosaic plot is generated. 

# Bibliography